<p-dialog
  header="Review Potential Transfers"
  [modal]="true"
  [visible]="visible()"
  (visibleChange)="onHide()"
  [style]="{ width: '1000px', 'max-width': '95vw' }"
  [draggable]="false"
  [resizable]="false">

  <p class="text-muted-color mb-4">
    The following transactions look like transfers between your accounts.
    Confirming them will mark them as "Transfers" so they don't count towards your income or expenses.
  </p>

  <p-table
    [value]="suggestions()"
    [loading]="loading()"
    styleClass="p-datatable-sm"
    responsiveLayout="scroll">
    
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 35%">Outgoing (Expense)</th>
        <th style="width: 15%" class="text-center">
          <i class="pi pi-arrow-right text-muted-color"></i>
        </th>
        <th style="width: 35%">Incoming (Income)</th>
        <th style="width: 150px">Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-suggestion>
      <tr>
        <!-- Outgoing Side -->
        <td class="align-top">
          <div class="flex flex-col gap-1">
            <span class="font-medium text-red-500">
              {{ formatCurrency(suggestion.sourceTransaction.amount) }}
            </span>
            <div class="text-sm text-color">{{ suggestion.sourceTransaction.accountName }}</div>
            <div class="text-xs text-muted-color">{{ formatDate(suggestion.sourceTransaction.date) }}</div>
            <div class="text-xs text-muted-color truncate" [pTooltip]="suggestion.sourceTransaction.description">
              {{ suggestion.sourceTransaction.description }}
            </div>
          </div>
        </td>

        <!-- Arrow -->
        <td class="text-center align-middle">
          <div class="flex flex-col items-center gap-1">
            <i class="pi pi-arrow-right text-primary"></i>
            <p-tag 
              [value]="Math.round(suggestion.confidenceScore * 100) + '% Match'" 
              severity="info" 
              styleClass="text-xs">
            </p-tag>
          </div>
        </td>

        <!-- Incoming Side -->
        <td class="align-top">
          <div class="flex flex-col gap-1">
            <span class="font-medium text-green-500">
              +{{ formatCurrency(Math.abs(suggestion.targetTransaction.amount)) }}
            </span>
            <div class="text-sm text-color">{{ suggestion.targetTransaction.accountName }}</div>
            <div class="text-xs text-muted-color">{{ formatDate(suggestion.targetTransaction.date) }}</div>
            <div class="text-xs text-muted-color truncate" [pTooltip]="suggestion.targetTransaction.description">
              {{ suggestion.targetTransaction.description }}
            </div>
          </div>
        </td>

        <!-- Actions -->
        <td class="text-center align-middle">
          <div class="flex flex-col gap-2">
            <p-button 
              icon="pi pi-check" 
              (onClick)="confirmMatch(suggestion)"
              [rounded]="true"
              severity="success"
              pTooltip="Confirm Transfer"
              tooltipPosition="left"
              size="small">
            </p-button>
            <p-button 
              icon="pi pi-times" 
              (onClick)="ignoreMatch(suggestion)"
              [rounded]="true"
              [text]="true"
              severity="secondary"
              pTooltip="Ignore"
              tooltipPosition="left"
              size="small">
            </p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center py-8 text-muted-color">
          No potential transfers found.
        </td>
      </tr>
    </ng-template>
  </p-table>

  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center w-full">
      <span class="text-muted-color text-sm">
        {{ suggestions().length }} suggestion(s) found
      </span>
      <div class="flex gap-2">
        <p-button 
          label="Close" 
          (onClick)="onHide()" 
          [text]="true" 
          severity="secondary">
        </p-button>
        <p-button 
          label="Confirm All" 
          icon="pi pi-check-circle" 
          (onClick)="confirmAll()" 
          [disabled]="suggestions().length === 0"
          [loading]="processing()"
          severity="primary">
        </p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>
