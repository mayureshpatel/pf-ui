<p-dialog
  [header]="dialogTitle"
  [modal]="true"
  [visible]="visible()"
  (visibleChange)="onHide()"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false">

  <form (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    @if (errorMessage()) {
      <p-message severity="error" [text]="errorMessage()!" styleClass="w-full" />
    }

    <!-- Category Name -->
    <div class="flex flex-col gap-2">
      <label for="name" class="font-medium text-color">
        Category Name <span class="text-red-500">*</span>
      </label>
      <input
        pInputText
        id="name"
        [(ngModel)]="formData.name"
        name="name"
        placeholder="e.g., Groceries"
        class="w-full"
        maxlength="50"
        required
      />
    </div>

    <div class="flex flex-col gap-2">
      <label for="vendorName" class="font-medium text-color">Parent Category (Optional)</label>
      <p-select
        id="parent"
        [(ngModel)]="formData.parentId"
        [options]="parentOptions()"
        optionLabel="label"
        optionValue="value"
        name="parent"
        placeholder="None (Top Level)"
        [showClear]="true"
        class="w-full"
        appendTo="body"
      />
    </div>

    <!-- Color Selection -->
    <div class="flex flex-col gap-2">
      <label class="font-medium text-color">Category Color</label>
      <div class="flex flex-wrap gap-2">
        @for (color of availableColors; track color) {
          <div
            [class]="color + ' w-8 h-8 rounded-full cursor-pointer transition-transform hover:scale-110 flex items-center justify-center'"
            [class.ring-2]="formData.color === color"
            [class.ring-offset-2]="formData.color === color"
            [class.ring-primary]="formData.color === color"
            (click)="selectColor(color)">
            @if (formData.color === color) {
              <i class="pi pi-check text-white text-sm"></i>
            }
          </div>
        }
      </div>
      @if (!formData.color && formData.name) {
        <small class="text-muted-color">
          Currently using auto-generated color based on name:
          <span [class]="previewColor + ' inline-block w-3 h-3 rounded-full align-middle ml-1'"></span>
        </small>
      }
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="onHide()"
      [text]="true"
      severity="secondary"
    />
    <p-button
      [label]="isEditMode ? 'Update' : 'Create'"
      icon="pi pi-check"
      (onClick)="onSubmit()"
      [loading]="loading()"
      severity="primary"
    />
  </ng-template>
</p-dialog>
