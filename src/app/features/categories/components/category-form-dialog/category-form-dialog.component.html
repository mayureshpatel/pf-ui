<p-dialog
  [header]="dialogTitle"
  [modal]="true"
  [visible]="visible()"
  (visibleChange)="onHide()"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false">

  <form (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    @if (errorMessage()) {
      <p-message severity="error" [text]="errorMessage()!" styleClass="w-full" />
    }

    <!-- Category Name -->
    <div class="flex flex-col gap-2">
      <label for="name" class="font-medium text-color">
        Category Name <span class="text-red-500">*</span>
      </label>
      <input
        pInputText
        id="name"
        [(ngModel)]="formData.name"
        name="name"
        placeholder="e.g., Groceries"
        class="w-full"
        maxlength="50"
        required
      />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-medium text-color">Category Type</label>
      <div class="flex gap-4">
        @for (option of typeOptions; track option.value) {
          <div class="flex items-center">
            <p-radioButton
              [inputId]="option.value"
              name="type"
              [value]="option.value"
              [(ngModel)]="formData.type"
            />
            <label [for]="option.value" class="ml-2 cursor-pointer">{{ option.label }}</label>
          </div>
        }
      </div>
    </div>

    <!-- Parent Category -->
    <div class="flex flex-col gap-2">
      <label for="parent" class="font-medium text-color">Parent Category (Optional)</label>
      <p-select
        id="parent"
        [(ngModel)]="formData.parentId"
        [options]="parentOptions()"
        optionLabel="label"
        optionValue="value"
        name="parent"
        placeholder="None (Top Level)"
        [showClear]="true"
        class="w-full"
        appendTo="body"
      />
    </div>

    <!-- Icon Selection -->
    <div class="flex flex-col gap-2">
      <label class="font-medium text-color">Icon</label>
      <div class="grid grid-cols-5 gap-2 max-h-40 overflow-y-auto p-2 border border-surface-200 dark:border-surface-700 rounded-lg">
        @for (icon of iconOptions; track icon) {
          <div
            [class]="'flex items-center justify-center p-2 rounded cursor-pointer transition-colors hover:bg-surface-100 dark:hover:bg-surface-700 ' + (formData.icon === icon ? 'bg-primary-100 dark:bg-primary-900/30 text-primary' : 'text-color')"
            [pTooltip]="getIconLabel(icon)"
            tooltipPosition="top"
            (click)="selectIcon(icon)">
            <i [class]="'pi ' + icon + ' text-xl'"></i>
          </div>
        }
      </div>
    </div>

    <!-- Color Selection -->
    <div class="flex flex-col gap-2">
      <label class="font-medium text-color">Category Color</label>
      <div class="flex flex-wrap gap-2">
        @for (color of availableColors; track color) {
          <div
            [class]="color + ' w-8 h-8 rounded-full cursor-pointer transition-transform hover:scale-110 flex items-center justify-center'"
            [class.ring-2]="formData.color === color"
            [class.ring-offset-2]="formData.color === color"
            [class.ring-primary]="formData.color === color"
            (click)="selectColor(color)">
            @if (formData.color === color) {
              <i class="pi pi-check text-white text-sm"></i>
            }
          </div>
        }
      </div>
      @if (!formData.color && formData.name) {
        <small class="text-muted-color">
          Currently using auto-generated color based on name:
          <span [class]="previewColor + ' inline-block w-3 h-3 rounded-full align-middle ml-1'"></span>
        </small>
      }
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="onHide()"
      [text]="true"
      severity="secondary"
    />
    <p-button
      [label]="isEditMode ? 'Update' : 'Create'"
      icon="pi pi-check"
      (onClick)="onSubmit()"
      [loading]="loading()"
      severity="primary"
    />
  </ng-template>
</p-dialog>
