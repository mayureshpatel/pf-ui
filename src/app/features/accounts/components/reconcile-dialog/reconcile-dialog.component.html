<p-dialog
  [header]="'Reconcile: ' + account().name"
  [modal]="true"
  [visible]="visible()"
  (visibleChange)="onHide()"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false">

  <div class="flex flex-col gap-4">
    <p class="text-muted-color">
      Enter the actual balance from your bank statement. An adjustment transaction will be created if there is a difference.
    </p>

    @if (errorMessage()) {
      <p-message severity="error" [text]="errorMessage()!" styleClass="w-full" />
    }

    <div class="flex flex-col gap-2">
      <label for="current" class="font-medium">System Balance</label>
      <div class="text-xl font-bold font-mono">
        {{ account().currentBalance | currency }}
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <label for="target" class="font-medium">Actual Bank Balance</label>
      <p-inputNumber
        id="target"
        [(ngModel)]="targetBalance"
        mode="currency"
        currency="USD"
        locale="en-US"
        [minFractionDigits]="2"
        [maxFractionDigits]="2"
        styleClass="w-full"
        inputStyleClass="w-full font-bold text-lg"
        [autofocus]="true"
      />
    </div>

    @if (targetBalance() !== null) {
      <div class="p-3 rounded border" 
           [ngClass]="{
             'bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800': difference() > 0,
             'bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800': difference() < 0,
             'bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700': difference() === 0
           }">
        <div class="flex justify-between items-center">
          <span class="font-medium text-sm">Difference</span>
          <span class="font-mono font-bold"
                [ngClass]="{
                  'text-green-600 dark:text-green-400': difference() > 0,
                  'text-red-600 dark:text-red-400': difference() < 0
                }">
            {{ difference() | currency }}
          </span>
        </div>
        <small class="block mt-1 text-muted-color">
          @if (difference() > 0) {
            A transaction of <strong>{{ difference() | currency }}</strong> (Income) will be created.
          } @else if (difference() < 0) {
            A transaction of <strong>{{ Math.abs(difference()) | currency }}</strong> (Expense) will be created.
          } @else {
            Balances match. No adjustment needed.
          }
        </small>
      </div>
    }
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button 
        label="Cancel" 
        icon="pi pi-times" 
        (onClick)="onHide()" 
        [text]="true" 
        severity="secondary" 
        [disabled]="saving()"
      />
      <p-button 
        label="Reconcile" 
        icon="pi pi-check" 
        (onClick)="submit()" 
        [loading]="saving()" 
        [disabled]="targetBalance() === null"
        severity="primary"
      />
    </div>
  </ng-template>
</p-dialog>
